var puzzle;(function(n){var t=createjs,i=function(){function n(n){this.id=n,this.view=document.getElementById(n),this.view&&this.init()}return n.prototype.catImage=function(){},n.prototype.createButton=function(n){var t=document.createElement("button");return t.value=n,t.innerText=n,t},n.prototype.init=function(){var n=this,i;this.canvas=document.createElement("canvas"),this.stage=new t.Stage(this.canvas),this.ctx=this.canvas.getContext("2d"),this.W=this.view.getAttribute("data-width")||800,this.H=this.view.getAttribute("data-height")||350,this.stage.setBounds(0,0,this.W,this.H),this.imageHolder=new f(this.stage),i=new e(this),$(this.view).find("button").click(function(t){return n.onControlClick(t.currentTarget)}),this.engine=new r(this.stage,function(){n.gameOver()})},n.prototype.onControlClick=function(n){switch(n.value.substr(0,5)){case"Start":if(trace("start"),this.engine.removePuzzles(),!this.imageHolder.bmp){alert("Please use Camera or select Image");return}if(this.isOver=!1,!this.engine.createPuzzles(this.imageHolder.bmp,this.imageHolder.recSource,$("#gamedemention").val())){alert("ERROR please restart game");return}this.imageHolder.removeImage(),this.engine.chaosImage(),this.strtTime=(new Date).getTime(),t.Ticker.addEventListener("tick",this.stage);break;case"Camer":if(this.engine.removePuzzles(),this.camera)this.imageHolder.createVideo(this.camera.video);else{var i=new u(this.W,this.H);this.camera=i.initCamera(this.onCameraReady())}break;case"Resta":this.engine.backImage(),trace("restart")}},n.prototype.gameOver=function(){this.isOver||(this.isOver=!0,alert("game Over in: "+Math.round(((new Date).getTime()-this.strtTime)/1e3)+" sec"),t.Ticker.removeEventListener("tick",this.stage))},n.prototype.onCameraReady=function(){var n=this;return function(t){var i=t.videoWidth,r=t.videoHeight;n.imageHolder.createVideo(t)}},n.prototype.onImageClicked=function(){var n=this;return function(t){n.engine.removePuzzles(),n.imageHolder.removeImage(),n.imageHolder.createImage(t.currentTarget)}},n.prototype.loadImages=function(){},n}();n.Game=i;var r=function(){function n(n,t){this.stage=n,this.gameOver=t,this.rects=[],this.puzzles=[]}return n.prototype.removePuzzles=function(){this.contPuzzles&&(this.stage.removeChild(this.contPuzzles),this.contPuzzles=null)},n.prototype.chaosImage=function(){var f=this,i,r,n,u;if(!this.inProgres)for(i=this.rects.slice(0),i=this.shuffle(i),this.isChaos=!0,this.inProgres=!0,setTimeout(function(){f.inProgres=!1},1100),r=this.puzzles,n=0,u=this.puzzles.length;n<u;n++)t.Tween.get(r[n]).to({x:i[n].x,y:i[n].y},1e3,t.Ease.circOut)},n.prototype.backImage=function(){var u=this,i,n,r;if(!this.inProgres)for(this.inProgres=!0,setTimeout(function(){u.inProgres=!1},1100),this.isChaos=!1,i=this.puzzles,n=0,r=i.length;n<r;n++)t.Tween.get(i[n]).to({x:this.rects[n].x,y:this.rects[n].y},1e3,t.Ease.circOut)},n.prototype.createPuzzles=function(n,i,r){var k=this,v=r.split("x"),c=Number(v[0]),l=Number(v[1]),s,b,h,u,f;if(isNaN(c)||isNaN(l))return alert("value of columns is wrong"),!1;this.removePuzzles();var a=i.width/c,y=i.height/l,o=n.scaleX;n.scaleX=1,n.scaleY=1,trace(i.width+"   dx: "+a);var e=new t.Container,p=[],w=[];for(s=0,b=c;s<b;s++)for(h=0;h<l;h++)u=new t.Rectangle(s*a,h*y,a,y),w.push(u),f=n.clone(),f.sourceRect=u,p.push(f),f.addEventListener(CLICK,function(n){return k.onImageClicked(n.currentTarget)}),f.x=u.x,f.y=u.y,e.addChild(f);return this.rects=w,this.puzzles=p,e.scaleX=o,e.scaleY=o,n.scaleX=o,n.scaleY=o,this.hiliter=new t.Shape((new t.Graphics).setStrokeStyle(3).beginStroke("#FFFFFF").drawRect(0,0,u.width,u.height)),this.stage.addChild(e),this.contPuzzles=e,!0},n.prototype.stickImage=function(n,i){var u=this,r;n.x=i.x,n.y=i.y,n.removeAllEventListeners(CLICK),r=new t.Shape((new t.Graphics).setStrokeStyle(5).beginStroke("#FFFFFF").drawCircle(0,0,100)),r.x=n.x+i.width/2,r.y=n.y+i.height/2,this.contPuzzles.addChild(r),t.Tween.get(r).to({scaleX:.1,scaleY:.1},500).call(function(){u.contPuzzles.removeChild(r),u.stage.update(),u.isAllinPlace()&&!u.isOver&&u.gameOver()})},n.prototype.isAllinPlace=function(){for(var t=this.puzzles,i=this.rects,r=!0,n=0,u=t.length;n<u;n++)Math.abs(t[n].x-i[n].x)+Math.abs(t[n].y-i[n].y)>10&&(r=!1);return r},n.prototype.checkPositions=function(n,t){for(var r=this.puzzles,u=this.rects,i=0,f=r.length;i<f;i++)(n===r[i]||t===r[i])&&Math.abs(r[i].x-u[i].x)+Math.abs(r[i].y-u[i].y)<10&&this.stickImage(r[i],u[i])},n.prototype.swapImages=function(n,i){var r=this;this.inProgres||(this.inProgres=!0,this.contPuzzles.addChild(n),this.contPuzzles.addChild(i),t.Tween.get(n).to({x:i.x,y:i.y},400,t.Ease.circOut),t.Tween.get(i).to({x:n.x,y:n.y},400,t.Ease.circOut),setTimeout(function(){r.checkPositions(n,i),r.inProgres=!1},500))},n.prototype.onImageClicked=function(n){this.contPuzzles.contains(this.hiliter)?(this.selectedImage!=n&&this.swapImages(this.selectedImage,n),this.selectedImage=null,this.contPuzzles.removeChild(this.hiliter)):(this.selectedImage=n,this.hiliter.x=n.x,this.hiliter.y=n.y,this.contPuzzles.addChild(this.hiliter))},n.prototype.shuffle=function(n){for(var i,r,t=n.length;t;i=Math.floor(Math.random()*t),r=n[--t],n[t]=n[i],n[i]=r);return n},n}(),u=function(){function n(n,t){this.w=n,this.h=t}return n.prototype.initCamera=function(n){var i=this,t;return(this.onVideoReady=n,t=navigator,t.getUserMedia=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia,!t.getUserMedia)?(alert("Your browser dosn't support Camera"),null):(t.getUserMedia({video:!0,audio:!0},function(n){return i.onCameraSuccess(n)},this.onCameraFail),this)},n.prototype.onCameraReady=function(n){var t=this;if(this.video=n,n.videoWidth<100)setTimeout(function(){return t.onCameraReady(n)},100);else this.onVideoReady(n)},n.prototype.onCameraSuccess=function(n){var r=this;this.camera=n;var i=window,u=i.URL||i.webkitURL,t=document.createElement("video");t.src=u.createObjectURL(n),t.play(),setTimeout(function(){return r.onCameraReady(t)},100)},n.prototype.onCameraFail=function(n){trace("onCamerafail"),trace(n)},n}(),f=function(){function n(n){this.stage=n,this.container=new t.Container,this.stage.addChild(this.container),this.container.setBounds(0,0,this.stage.getBounds().width,this.stage.getBounds().height)}return n.prototype.removeImage=function(){this.container.removeAllChildren(),t.Ticker.removeEventListener("tick",this.stage)},n.prototype.createVideo=function(n){t.Ticker.addEventListener("tick",this.stage),this.isVideo=!0,this.bmp=new t.Bitmap(n),this.container.removeAllChildren(),this.container.addChild(this.bmp),this.centerImage(n.videoWidth,n.videoHeight)},n.prototype.createImage=function(n){(t.Ticker.removeEventListener("tick",this.stage),n.tagName.toLowerCase()=="img")&&(this.isVideo=!1,this.container.removeAllChildren(),this.bmp=new t.Bitmap(n),this.container.addChild(this.bmp),this.bmp.image=n,this.centerImage(n.naturalWidth,n.naturalHeight),this.stage.update())},n.prototype.centerImage=function(n,i){this.recSource=new t.Rectangle(0,0,n,i);var u=this.container.getBounds(),r=u.width/n,f=u.height/i,r=r>f?f:r;this.bmp.scaleX=r,this.bmp.scaleY=r},n}(),e=function(){function n(n){var h=document.createElement("div"),i,o,t,r,u,s,f,c,e;for($(n.view).append(h),i=document.createElement("div"),o=document.createElement("span"),o.innerText="Select Image above and choose game resolution ",$(i).append(o),t=document.createElement("select"),t.id="gamedemention",$(t).css("width","90px"),$(t).css("padding-left","20px"),$(t).css("marging-right","20px"),$(i).append(t),r=document.createElement("button"),r.value="Start",r.innerText="Start Game",$(i).append(r),u=document.createElement("button"),u.value="Camera",u.innerText="Use my Camera",$(i).append(u),$(i).children("button").css("margin-left","30px"),$(n.view).append(i),s=Array("4x4","5x5","6x6","7x7","8x8","10x10"),f=0,c=s.length;f<c;f++)$(t).append("<option>"+s[f]+"<\/option>");$(t).change(function(){var n=this;trace($(n).val())}),e=document.createElement("div"),$(e).css("margin-top","8px"),$(e).append(n.canvas),$(n.view).append(e),n.canvas.width=n.W,n.canvas.height=n.H,n.stage.setBounds(0,0,n.W,n.H),$.get("/Services/index.php",{a:"getexamples"},"json").done(function(t){var r,u,i;for(n.images=[],r=0,u=t.data.length;r<u;r++)i=new Image,i.src=t.folder+t.data[r],i.addEventListener(CLICK,n.onImageClicked()),$(i).css("width","100px"),$(i).css("height","80px"),$(h).prepend(i)})}return n}()})(puzzle||(puzzle={}));var trace=trace||function(n){console.log(n)},myPuzzle=new puzzle.Game("html5puzzle"),CLICK=CLICK||"click";
//# sourceMappingURL=myPuzzle.min.js.map